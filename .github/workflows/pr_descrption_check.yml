name: Check PR Description

on:
  pull_request:
    types:
      - opened
      - synchronize
      - edited

jobs:
  check_pr_description:
    runs-on: ubuntu-latest
    env:
      GH_TOKEN: ${{ github.token }}

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Read PR Description
        id: pr
        run: echo "::set-output name=description::$(curl -s -H \"Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}\" ${{ github.api_url }}/repos/${{ github.repository }}/pulls/${{ github.event.number }} | jq -r .body)"

      - name: Read Template
        id: template
        run: echo "::set-output name=template::$(< .github/workflows/pull_request_template.md)"

      - name: Compare PR Description with Template
        run: |
          if [ "${{ steps.pr.outputs.description }}" != "${{ steps.template.outputs.template }}" ]; then
            echo "PR description does not match the template."
            exit 1
          else
            echo "PR description matches the template."
          fi
