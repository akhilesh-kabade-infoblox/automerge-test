name: Auto Merge

on:
  pull_request:
    branches:
      - main

jobs:
  auto-merge:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Auto merge to develop
      run: |
        # Ensure the base branch is 'develop'
        if [ "$GITHUB_EVENT_NAME" == "pull_request" ]; then
          BASE_BRANCH=$(jq -r ".pull_request.base.ref" "$GITHUB_EVENT_PATH")
          if [ "$BASE_BRANCH" != "develop" ]; then
            echo "Not merging to develop branch."
            exit 0
          fi
        fi

        # Auto-approve and merge
        PR_NUMBER=$(jq -r ".pull_request.number" "$GITHUB_EVENT_PATH")
        REPO_TOKEN=${{ secrets.GITHUB_TOKEN }}
        GITHUB_API="https://api.github.com/repos/${{ github.repository }}/pulls/$PR_NUMBER/merge"
        curl -X PUT -H "Authorization: token $REPO_TOKEN" "$GITHUB_API"

      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
